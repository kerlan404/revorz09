<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <title>Detail - Revorz</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #050505; color: #fff; }
        .glass-card { background: rgba(15, 15, 15, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="p-8">
    <button onclick="history.back()" class="mb-8 flex items-center gap-2 text-gray-500 hover:text-white transition font-bold text-xs uppercase tracking-widest">
        <i data-lucide="arrow-left" class="w-4 h-4"></i> Back
    </button>

    <div id="detailView" class="max-w-6xl mx-auto"></div>

    <script>
        // Check if user is logged in by checking sessionStorage
        if (!sessionStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }

        // Check if user is admin and redirect if needed
        if (sessionStorage.getItem('role') === 'ADMIN') {
            window.location.href = 'admin-dashboard.html';
        }

        function loadDetail() {
            const pid = localStorage.getItem('current_pid');
            const products = JSON.parse(localStorage.getItem('revorz_products')) || [];
            const p = products.find(x => x.id == pid);

            if(!p) return;

            document.getElementById('detailView').innerHTML = `
                <div class="grid md:grid-cols-2 gap-16">
                    <div class="glass-card rounded-[3rem] overflow-hidden border border-white/10">
                        <img id="productImage" src="${p.img || 'product-white.png'}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex flex-col justify-center">
                        <h1 class="text-6xl font-black italic tracking-tighter mb-4">${p.nama}</h1>
                        <p class="text-4xl text-blue-600 font-black mb-8">Rp ${p.harga.toLocaleString('id-ID')}</p>

                        <div class="mb-8">
                            <h4 class="text-xs font-black uppercase tracking-widest text-gray-500 mb-4">Pilih Warna</h4>
                            <div class="flex gap-4">
                                <div class="color-option p-3 rounded-2xl flex flex-col items-center gap-2 ${p.warna === 'white' || (!p.warna || p.warna === '') ? 'selected' : ''}" data-color="white" data-image="product-white.png" data-price="${p.harga}">
                                    <div class="w-10 h-10 rounded-full bg-white border border-zinc-300"></div>
                                    <span class="text-[10px] font-bold uppercase">Putih</span>
                                </div>
                                <div class="color-option p-3 rounded-2xl flex flex-col items-center gap-2 ${p.warna === 'black' ? 'selected' : ''}" data-color="black" data-image="product-black.png" data-price="${p.harga}">
                                    <div class="w-10 h-10 rounded-full bg-black border border-zinc-700"></div>
                                    <span class="text-[10px] font-bold uppercase">Hitam</span>
                                </div>
                                <div class="color-option p-3 rounded-2xl flex flex-col items-center gap-2 ${p.warna === 'blue' ? 'selected' : ''}" data-color="blue" data-image="product-blue.png" data-price="${p.harga}">
                                    <div class="w-10 h-10 rounded-full bg-blue-900 border border-zinc-700"></div>
                                    <span class="text-[10px] font-bold uppercase">Biru</span>
                                </div>
                            </div>
                        </div>

                        <div class="glass-card p-8 rounded-[2rem] mb-8">
                            <h4 class="text-xs font-black uppercase tracking-widest text-gray-500 mb-2">Description</h4>
                            <p class="text-gray-400 leading-relaxed">${p.desc}</p>
                        </div>

                        <div class="flex items-center gap-6 mb-10">
                            <div class="bg-white/5 border border-white/10 px-6 py-4 rounded-2xl flex items-center gap-6">
                                <button onclick="updateQty(-1)" class="text-xl font-bold">-</button>
                                <span id="qty" class="text-xl font-black">1</span>
                                <button onclick="updateQty(1)" class="text-xl font-bold">+</button>
                            </div>
                            <p class="text-xs text-gray-600 font-bold uppercase tracking-widest">Stok: ${p.stok} Pcs</p>
                        </div>

                        <button onclick="addToCart()" class="bg-white text-black py-6 rounded-3xl font-black uppercase tracking-[0.2em] hover:bg-blue-600 hover:text-white transition duration-500">Add To Cart</button>
                    </div>
                </div>
            `;
            
            // Setup color selection functionality
            setupColorSelection();
            lucide.createIcons();
        }

        function setupColorSelection() {
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Update UI
                    document.querySelectorAll('.color-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');

                    // Get data attributes
                    const imgPath = this.getAttribute('data-image');
                    const colorName = this.getAttribute('data-color');
                    const priceVal = this.getAttribute('data-price');

                    // Change image
                    const imgEl = document.getElementById('productImage');
                    imgEl.src = imgPath;

                    // Update price if needed
                    // document.getElementById('price').textContent = priceVal;
                });
            });
        }

        let currentQty = 1;
        function updateQty(n) {
            currentQty = Math.max(1, currentQty + n);
            document.getElementById('qty').innerText = currentQty;
        }

        function addToCart() {
            const pid = localStorage.getItem('current_pid');
            const products = JSON.parse(localStorage.getItem('revorz_products')) || [];
            const p = products.find(x => x.id == pid);

            // Get selected color
            const selectedColorOption = document.querySelector('.color-option.selected');
            const selectedColor = selectedColorOption ? selectedColorOption.getAttribute('data-color') : p.warna || 'white';
            const selectedImage = selectedColorOption ? selectedColorOption.getAttribute('data-image') : p.img;

            let cart = JSON.parse(localStorage.getItem('revorz_cart')) || [];
            cart.push({ 
                ...p, 
                qty: currentQty,
                warna: selectedColor,
                img: selectedImage
            });
            localStorage.setItem('revorz_cart', JSON.stringify(cart));

            // Tampilkan notifikasi daripada alert
            showNotification('Produk berhasil ditambahkan ke keranjang!', 'success');

            // Arahkan ke halaman cart setelah 1.5 detik
            setTimeout(() => {
                window.location.href = "cart.html";
            }, 1500);
        }
        window.onload = loadDetail;

        // Fungsi notifikasi global
        function showNotification(message, type = 'info') {
            // Hapus notifikasi sebelumnya jika ada
            let existingNotification = document.getElementById('web-notification');
            if(existingNotification) {
                existingNotification.remove();
            }

            // Tentukan warna berdasarkan tipe notifikasi
            let bgColor = '#1524f4'; // Biru default untuk info
            if(type === 'success') bgColor = '#10b981'; // Hijau untuk sukses
            if(type === 'error') bgColor = '#ef4444'; // Merah untuk error
            if(type === 'warning') bgColor = '#f59e0b'; // Kuning untuk warning

            // Buat elemen notifikasi
            const notification = document.createElement('div');
            notification.id = 'web-notification';
            notification.className = 'fixed top-6 right-6 px-6 py-4 rounded-xl shadow-lg z-[1000] max-w-sm';
            notification.style.backgroundColor = bgColor;
            notification.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
            notification.style.color = 'white';
            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="mr-3">
                        <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'alert-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-bold text-sm">${type.charAt(0).toUpperCase() + type.slice(1)}</p>
                        <p class="text-xs opacity-80">${message}</p>
                    </div>
                    <button onclick="closeNotification()" class="ml-2 text-white">Ã—</button>
                </div>
            `;

            // Tambahkan ke body
            document.body.appendChild(notification);
            lucide.createIcons();

            // Tampilkan dengan animasi
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 10);

            // Otomatis hilangkan setelah 5 detik
            setTimeout(() => {
                closeNotification();
            }, 5000);
        }

        function closeNotification() {
            const notification = document.getElementById('web-notification');
            if(notification) {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }
        }
    </script>
</body>
</html>